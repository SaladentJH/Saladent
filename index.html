<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Systematic Multi Strategy | Prop Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; overflow-x: hidden; background-color: #020617; }
        .dashboard-card { background: #0f172a; border: 1px solid #1e293b; transition: all 0.2s; }
        .dashboard-card:hover { border-color: #38bdf8; }
        .nav-tab { cursor: pointer; padding: 1rem 1.25rem; transition: all 0.3s; border-bottom: 2px solid transparent; color: #64748b; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
        .nav-tab.active { color: #38bdf8; border-bottom-color: #38bdf8; background: linear-gradient(to top, rgba(56, 189, 248, 0.1), transparent); }
        .hidden { display: none !important; }
        .modal-overlay { background: rgba(2, 6, 23, 0.9); backdrop-filter: blur(8px); }
        .status-up { color: #10b981; }
        .status-down { color: #ef4444; }
        /* Table Custom */
        .perf-table th { background: #1e293b; color: #94a3b8; font-size: 0.7rem; padding: 0.75rem; text-align: left; }
        .perf-table td { padding: 0.75rem; border-bottom: 1px solid #1e293b; font-size: 0.8rem; }
    </style>
</head>
<body class="text-slate-200">

    <!-- [1] 로그인 게이트 -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="max-w-md w-full bg-slate-900 border border-slate-800 p-10 rounded-3xl shadow-2xl text-center">
            <div class="w-20 h-20 bg-sky-600 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-lg shadow-sky-500/20">
                <i class="fas fa-terminal text-3xl text-white"></i>
            </div>
            <h1 class="text-2xl font-black text-white mb-2 tracking-tighter">SYSTEMATIC MULTI STRATEGY</h1>
            <p class="text-slate-500 text-xs mb-10 font-medium uppercase tracking-widest">Internal Trading Intelligence</p>
            <button id="btn-login" class="w-full bg-white text-slate-900 font-bold py-4 rounded-xl transition-all flex items-center justify-center gap-3 hover:bg-sky-400 hover:text-white active:scale-95">
                <i class="fab fa-google text-lg"></i> 사내 계정 접속
            </button>
            <p class="mt-8 text-[10px] text-slate-700 font-mono tracking-tighter">AUTH_EMAILS: hongjiheon@gmail.com, venture1219@gmail.com</p>
        </div>
    </div>

    <!-- [2] 메인 레이아웃 -->
    <div id="main-dashboard" class="hidden min-h-screen flex flex-col">
        <!-- 상단 바 -->
        <nav class="fixed w-full z-50 border-b border-slate-800/50 bg-[#020617]/95 backdrop-blur-md">
            <div class="max-w-[1600px] mx-auto px-6 flex justify-between h-16 items-center">
                <div class="flex items-center gap-4">
                    <div class="w-9 h-9 bg-sky-600 rounded-xl flex items-center justify-center shadow-md shadow-sky-500/30">
                        <span class="text-white font-bold text-xs font-mono text-[10px]">SMS</span>
                    </div>
                    <span class="text-lg font-black text-white tracking-tighter uppercase">Systematic Multi Strategy</span>
                </div>
                <div class="flex items-center gap-8">
                    <div class="flex items-center gap-3">
                        <span class="text-[11px] text-slate-500 font-mono" id="display-user-email">Loading...</span>
                        <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                    </div>
                    <button id="btn-logout" class="text-[10px] text-slate-500 hover:text-rose-400 font-bold tracking-widest transition-colors uppercase">Logout</button>
                </div>
            </div>
            <!-- 탭 메뉴 -->
            <div class="max-w-[1600px] mx-auto px-4 flex border-t border-slate-800/30 overflow-x-auto no-scrollbar">
                <div class="nav-tab active" data-tab="dashboard"><i class="fas fa-th-large mr-2"></i>대시보드</div>
                <div class="nav-tab" data-tab="performance"><i class="fas fa-chart-line mr-2"></i>운용 성과</div>
                <div class="nav-tab" data-tab="strategy-live"><i class="fas fa-vial mr-2"></i>운용 전략</div>
                <div class="nav-tab" data-tab="strategy-rd"><i class="fas fa-microchip mr-2"></i>개발 전략</div>
                <div class="nav-tab" data-tab="books"><i class="fas fa-book-open mr-2"></i>관련 서적</div>
            </div>
        </nav>

        <!-- 메인 콘텐츠 -->
        <main class="flex-1 pt-36 pb-16 px-6 max-w-[1600px] mx-auto w-full">
            
            <!-- [탭] 대시보드 -->
            <section id="tab-dashboard" class="tab-content animate-in fade-in duration-500">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-10">
                    <div class="dashboard-card p-6 rounded-2xl border-emerald-500/20 bg-emerald-500/5">
                        <p class="text-slate-500 text-[10px] font-bold uppercase mb-1 tracking-widest">Today's PnL Sum</p>
                        <div class="text-3xl font-black text-emerald-400" id="dash-total-pnl">+$0</div>
                    </div>
                    <div class="dashboard-card p-6 rounded-2xl">
                        <p class="text-slate-500 text-[10px] font-bold uppercase mb-1 tracking-widest">Active Positions</p>
                        <div class="text-3xl font-black text-white" id="dash-pos-count">0</div>
                    </div>
                    <div class="dashboard-card p-6 rounded-2xl">
                        <p class="text-slate-500 text-[10px] font-bold uppercase mb-1 tracking-widest">Risk Exposure</p>
                        <div class="text-3xl font-black text-orange-400">Stable</div>
                    </div>
                    <div class="dashboard-card p-6 rounded-2xl">
                        <p class="text-slate-500 text-[10px] font-bold uppercase mb-1 tracking-widest">Market Context</p>
                        <div class="text-3xl font-black text-sky-400">Neutral</div>
                    </div>
                </div>

                <div class="grid lg:grid-cols-12 gap-10">
                    <div class="lg:col-span-8">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-lg font-bold text-white flex items-center gap-3">
                                <i class="fas fa-list-ul text-sky-500"></i> 실시간 포지션 상황
                            </h2>
                            <button onclick="toggleModal('position-modal', true)" class="bg-slate-800 hover:bg-slate-700 text-slate-300 px-4 py-2 rounded-xl text-[10px] font-bold tracking-widest uppercase transition-all">
                                Update Data
                            </button>
                        </div>
                        <div class="dashboard-card rounded-2xl overflow-hidden">
                            <table class="w-full text-left perf-table">
                                <thead>
                                    <tr>
                                        <th>Ticker</th>
                                        <th>Side</th>
                                        <th class="text-right">Current PnL</th>
                                    </tr>
                                </thead>
                                <tbody id="dash-pos-list">
                                    <!-- Dynamic -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="lg:col-span-4 space-y-8">
                        <div>
                            <h2 class="text-lg font-bold text-white mb-6 flex items-center gap-3">
                                <i class="fas fa-bolt text-rose-500 text-sm"></i> 최근 실시간 얼러트
                            </h2>
                            <div class="space-y-3" id="dash-alert-list">
                                <div class="p-4 bg-slate-900/50 border-l-2 border-sky-500 rounded-xl text-[11px]">
                                    <p class="text-slate-200 font-bold mb-1">KAU25 포지션 업데이트</p>
                                    <p class="text-slate-500 leading-relaxed">익스포저 43.6억 확인. DTD 수익률 -0.8% 기록 중.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- [탭] 운용 성과 -->
            <section id="tab-performance" class="tab-content hidden animate-in fade-in duration-500">
                <div class="grid gap-10">
                    <div class="dashboard-card p-8 rounded-3xl overflow-hidden relative">
                        <div class="flex justify-between items-center mb-8 relative z-10">
                            <div>
                                <h2 class="text-xl font-black text-white uppercase tracking-tight">Cumulative PnL Graph</h2>
                                <p class="text-xs text-slate-500 mt-1">부서 전체 전략 합산 누적 수익 곡선 (Equity Curve)</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="text-[10px] font-mono text-slate-500">Data Source: Excel Integration</span>
                            </div>
                        </div>
                        <div class="h-[450px] w-full">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>

                    <div class="dashboard-card rounded-3xl overflow-hidden">
                        <div class="bg-slate-900 px-8 py-5 border-b border-slate-800 flex justify-between items-center">
                            <h2 class="font-black text-white uppercase tracking-widest text-sm">Strategy Profit & Loss Table</h2>
                            <button onclick="toggleModal('performance-upload-modal', true)" class="text-[10px] text-sky-500 font-bold uppercase tracking-widest hover:underline">Sync Performance</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left perf-table">
                                <thead class="bg-slate-950/50">
                                    <tr>
                                        <th class="pl-8">Strategy Type</th>
                                        <th>Asset</th>
                                        <th>Fund Code</th>
                                        <th class="text-right">Exposure (억)</th>
                                        <th class="text-right">DTD (억)</th>
                                        <th class="text-right">MTD (억)</th>
                                        <th class="text-right pr-8">YTD (억)</th>
                                    </tr>
                                </thead>
                                <tbody id="perf-strategy-list" class="divide-y divide-slate-800/30">
                                    <!-- Dynamic Excel-like Data -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- [탭] 운용 전략 / 개발 전략 -->
            <section id="tab-strategy-live" class="tab-content hidden animate-in fade-in duration-500">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-xl font-black text-white uppercase"><i class="fas fa-play-circle text-emerald-500 mr-3"></i>Live Operation Strategies</h2>
                    <button onclick="toggleModal('strategy-modal', true, 'live')" class="bg-sky-600 px-5 py-2.5 rounded-xl text-[10px] font-bold uppercase tracking-widest shadow-lg shadow-sky-600/20 transition-all">전략 등록</button>
                </div>
                <div id="live-strat-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </section>

            <section id="tab-strategy-rd" class="tab-content hidden animate-in fade-in duration-500">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-xl font-black text-white uppercase"><i class="fas fa-microchip text-sky-500 mr-3"></i>R&D Pipeline</h2>
                    <button onclick="toggleModal('strategy-modal', true, 'rd')" class="bg-slate-800 px-5 py-2.5 rounded-xl text-[10px] font-bold uppercase tracking-widest hover:bg-slate-700 transition-all">연구 등록</button>
                </div>
                <div id="rd-strat-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </section>

            <!-- [탭] 관련 서적 -->
            <section id="tab-books" class="tab-content hidden animate-in fade-in duration-500">
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <!-- Book Card 1 -->
                    <div class="dashboard-card p-6 rounded-3xl flex flex-col items-center text-center group">
                        <div class="w-32 h-44 bg-slate-800 rounded-xl mb-6 shadow-2xl flex items-center justify-center text-slate-700 group-hover:bg-slate-700 transition-colors">
                            <i class="fas fa-book text-5xl"></i>
                        </div>
                        <h3 class="font-bold text-white mb-2">The Complete TurtleTrader</h3>
                        <p class="text-[11px] text-slate-500 leading-relaxed font-light mb-4">추세 추종 전략의 정수와 시스템 트레이딩의 기원</p>
                        <button class="text-[10px] text-sky-500 font-bold uppercase tracking-widest hover:underline">View Summary</button>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- [모달] 포지션 업데이트 -->
    <div id="position-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 modal-overlay">
        <div class="bg-slate-900 border border-slate-800 w-full max-w-sm rounded-3xl p-8 shadow-2xl">
            <h3 class="text-lg font-black text-white mb-6 uppercase tracking-widest">Update Live Position</h3>
            <div class="space-y-4">
                <input type="text" id="pos-asset" class="w-full bg-slate-950 border border-slate-800 rounded-xl p-4 text-xs uppercase text-slate-200" placeholder="Ticker (e.g. KAU25)">
                <select id="pos-side" class="w-full bg-slate-950 border border-slate-800 rounded-xl p-4 text-xs text-slate-200">
                    <option value="LONG">LONG (매수)</option>
                    <option value="SHORT">SHORT (매도)</option>
                    <option value="FLAT">FLAT (중립)</option>
                </select>
                <input type="text" id="pos-pnl" class="w-full bg-slate-950 border border-slate-800 rounded-xl p-4 text-xs text-slate-200" placeholder="PnL (e.g. +1.42%)">
                <button id="btn-submit-position" class="w-full bg-sky-600 hover:bg-sky-500 text-white font-black py-4 rounded-xl mt-4 transition-all uppercase tracking-widest text-[11px]">Sync Now</button>
                <button onclick="toggleModal('position-modal', false)" class="w-full text-slate-600 text-[10px] font-bold uppercase tracking-widest mt-2 hover:text-white">Cancel</button>
            </div>
        </div>
    </div>

    <!-- [모달] 전략 등록 -->
    <div id="strategy-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 modal-overlay">
        <div class="bg-slate-900 border border-slate-800 w-full max-w-xl rounded-3xl p-10 shadow-2xl">
            <h3 class="text-xl font-black text-white mb-8 uppercase tracking-widest">Register Intelligence</h3>
            <div class="space-y-5">
                <input type="hidden" id="strat-modal-type">
                <input type="text" id="strat-title" class="w-full bg-slate-950 border border-slate-800 rounded-xl p-4 text-xs text-slate-200 outline-none focus:border-sky-500" placeholder="전략 제목">
                <textarea id="strat-content" rows="8" class="w-full bg-slate-950 border border-slate-800 rounded-xl p-4 text-xs text-slate-200 outline-none focus:border-sky-500" placeholder="전략 가설, 로직, 기대 수익 및 리스크 관리 계획을 상세히 기술하세요."></textarea>
                <button id="btn-submit-strategy" class="w-full bg-sky-600 hover:bg-sky-500 text-white font-black py-4 rounded-xl mt-4 transition-all uppercase tracking-widest text-[11px]">Upload Alpha</button>
            </div>
        </div>
    </div>

    <!-- Firebase & Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, addDoc, collection, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDcB3T2qsVXTAQcvyCmTLOs3oG4-JKQXb8",
            authDomain: "systematic-multi-strategy.firebaseapp.com",
            projectId: "systematic-multi-strategy",
            storageBucket: "systematic-multi-strategy.firebasestorage.app",
            messagingSenderId: "610043483304",
            appId: "1:610043483304:web:1cca53180e7003f3375e9d",
            measurementId: "G-1BLY90C518"
        };

        const ALLOWED_EMAILS = ["hongjiheon@gmail.com", "venture1219@gmail.com"];
        const APP_ID = 'prop-desk-hub';

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // 탭 제어
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.onclick = () => {
                const target = tab.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.getElementById('tab-' + target).classList.remove('hidden');
                tab.classList.add('active');
                if(target === 'performance') initChart();
            }
        });

        // 인증 로직
        const btnLogin = document.getElementById('btn-login');
        const btnLogout = document.getElementById('btn-logout');
        
        btnLogin.onclick = async () => {
            try { await signInWithPopup(auth, provider); } catch (e) { console.error(e); }
        };
        btnLogout.onclick = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            if (user && ALLOWED_EMAILS.includes(user.email)) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-dashboard').classList.remove('hidden');
                document.getElementById('display-user-email').textContent = user.email;
                startDataSync();
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-dashboard').classList.add('hidden');
                if(user) { alert("Access Denied."); signOut(auth); }
            }
        });

        // 실시간 데이터 동기화
        function startDataSync() {
            // 포지션 데이터
            onSnapshot(collection(db, 'artifacts', APP_ID, 'public', 'data', 'positions'), (snap) => {
                const list = document.getElementById('dash-pos-list');
                document.getElementById('dash-pos-count').textContent = snap.size;
                list.innerHTML = '';
                snap.docs.forEach(doc => {
                    const d = doc.data();
                    const isUp = d.pnl.includes('+');
                    list.insertAdjacentHTML('beforeend', `
                        <tr>
                            <td class="font-black text-white pl-8 uppercase">${d.asset}</td>
                            <td class="font-bold ${d.side === 'LONG' ? 'status-up' : 'status-down'}">${d.side}</td>
                            <td class="text-right pr-8 font-mono font-bold ${isUp ? 'status-up' : 'status-down'}">${d.pnl}</td>
                        </tr>
                    `);
                });
            });

            // 전략 데이터 (Live / RD 구분)
            onSnapshot(collection(db, 'artifacts', APP_ID, 'public', 'data', 'strategies'), (snap) => {
                const liveList = document.getElementById('live-strat-list');
                const rdList = document.getElementById('rd-strat-list');
                liveList.innerHTML = ''; rdList.innerHTML = '';

                snap.docs.forEach(doc => {
                    const d = doc.data();
                    const card = `
                        <div class="dashboard-card p-8 rounded-3xl relative overflow-hidden group">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-sky-600/5 rounded-full -mr-16 -mt-16 transition-all group-hover:bg-sky-600/10"></div>
                            <h3 class="font-black text-white text-lg mb-3 tracking-tighter">${d.title}</h3>
                            <p class="text-[11px] text-slate-500 leading-relaxed font-light mb-8 line-clamp-4">${d.content}</p>
                            <div class="flex justify-between items-center text-[9px] text-slate-600 font-bold border-t border-slate-800 pt-4 uppercase tracking-widest font-mono">
                                <span><i class="far fa-user mr-1 text-sky-500"></i>${d.authorEmail.split('@')[0]}</span>
                                <span>${d.timestamp ? new Date(d.timestamp.seconds * 1000).toLocaleDateString() : ''}</span>
                            </div>
                        </div>
                    `;
                    if(d.type === 'live') liveList.insertAdjacentHTML('beforeend', card);
                    else rdList.insertAdjacentHTML('beforeend', card);
                });
            });

            // 성과 데이터 (Mock - 실제 구축 시 Firestore에 엑셀 데이터를 업로드하는 로직 구현 가능)
            const perfList = document.getElementById('perf-strategy-list');
            const mockPerfData = [
                { type: "Trend Maker", asset: "KAU", code: "20300", exp: 43.66, dtd: -0.81, mtd: -0.81, ytd: 20.31 },
                { type: "VCM Alpha", asset: "VER", code: "20400", exp: 19.95, dtd: 0.00, mtd: 0.00, ytd: 6.37 },
                { type: "Ab-Arb Master", asset: "ETF", code: "10210", exp: 58.60, dtd: 0.05, mtd: 0.05, ytd: 2.01 },
                { type: "Quant Intra", asset: "KOSPI", code: "10208", exp: 0.00, dtd: -0.43, mtd: -0.43, ytd: 1.62 }
            ];
            
            perfList.innerHTML = '';
            mockPerfData.forEach(p => {
                perfList.insertAdjacentHTML('beforeend', `
                    <tr class="hover:bg-slate-800/30 transition-colors">
                        <td class="pl-8 font-black text-sky-400 uppercase tracking-tighter">${p.type}</td>
                        <td class="font-bold text-slate-300">${p.asset}</td>
                        <td class="font-mono text-slate-600 text-[10px]">${p.code}</td>
                        <td class="text-right font-mono text-slate-400">${p.exp.toFixed(2)}</td>
                        <td class="text-right font-mono font-bold ${p.dtd >= 0 ? 'status-up' : 'status-down'}">${p.dtd >= 0 ? '+' : ''}${p.dtd.toFixed(2)}</td>
                        <td class="text-right font-mono font-bold ${p.mtd >= 0 ? 'status-up' : 'status-down'}">${p.mtd >= 0 ? '+' : ''}${p.mtd.toFixed(2)}</td>
                        <td class="text-right pr-8 font-mono font-bold ${p.ytd >= 0 ? 'status-up' : 'status-down'}">${p.ytd >= 0 ? '+' : ''}${p.ytd.toFixed(2)}</td>
                    </tr>
                `);
            });
        }

        // PnL 차트 초기화 (엑셀 데이터 기반 시뮬레이션)
        function initChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            if(window.pnlChartInstance) window.pnlChartInstance.destroy();
            
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(56, 189, 248, 0.2)');
            gradient.addColorStop(1, 'rgba(56, 189, 248, 0)');

            window.pnlChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Equity Curve (억)',
                        data: [1.2, 3.5, 2.8, 5.2, 8.4, 7.9, 12.3, 16.1, 15.5, 19.4, 23.2, 28.5],
                        borderColor: '#38bdf8',
                        borderWidth: 4,
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#38bdf8'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false } },
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, border: { display: false }, ticks: { color: '#475569', font: { family: 'monospace', size: 10 } } },
                        x: { grid: { display: false }, border: { display: false }, ticks: { color: '#475569', font: { family: 'monospace', size: 10 } } }
                    }
                }
            });
        }

        // 모달 데이터 제출
        document.getElementById('btn-submit-position').onclick = async () => {
            const asset = document.getElementById('pos-asset').value.toUpperCase();
            const side = document.getElementById('pos-side').value;
            const pnl = document.getElementById('pos-pnl').value;
            if(!asset || !pnl) return;
            await setDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'positions', asset), { asset, side, pnl, timestamp: serverTimestamp() });
            toggleModal('position-modal', false);
        };

        document.getElementById('btn-submit-strategy').onclick = async () => {
            const type = document.getElementById('strat-modal-type').value;
            const title = document.getElementById('strat-title').value;
            const content = document.getElementById('strat-content').value;
            if(!title || !content) return;
            await addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'strategies'), {
                type, title, content, authorEmail: auth.currentUser.email, timestamp: serverTimestamp()
            });
            toggleModal('strategy-modal', false);
            document.getElementById('strat-title').value = '';
            document.getElementById('strat-content').value = '';
        };

        window.toggleModal = (id, show, type = '') => {
            document.getElementById(id).classList.toggle('hidden', !show);
            if(id === 'strategy-modal') document.getElementById('strat-modal-type').value = type;
        };

    </script>
</body>
</html>
